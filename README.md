This Repo demonstrated a double free vulnerability


In order to run this program, compile the program using the makefile, then run the following command:

./secret [password]

where [password] is the input password you are using. If the input password matches the saved password (CorrectHorseBatteryStaple) then the message in secret.txt will be printed to the command line. Otherwise, it will say the password is incorrect.


The Exploit:

The exploit comes from causing the msg variable to be free'd twice. This is done by changing your LOGNAME environment variable to be long enough to enter the if statement on line 34 of secret.cpp. Once this happens, the two mallocs on lines 74 and 75 will return the same pointer. Since these two pointers are used to compare the hash of the input and saved passwords, the program will always think that the inputted passwords hash matches the saved hash, causing the contents of secret.txt to be printed without the need to enter the correct password.

This exploit can be done by running the exploit.sh file.


Files:

exploit.sh: bash script utilizing the exploit

makefile: makefile

password.txt: Hash of the password needed to access secret.txt

secret: compiled binary of secret.txt

secret.cpp: c++ file with the double free vulnerability

secret.txt: secret that is revealed with correct password

sha256.cpp: sha256 implementation

sha256.hpp: header for sha256.cpp
